import mapsy
from shapely.geometry import shape

from mapsy.geo_util import Box


json = {
    "type": "Polygon",
    "coordinates": [
        [
            [9.817620065608009, 54.935805500433716],
            [8.621358380918567, 54.917401474515415],
            [9.007842925202848, 53.849967971254067],
            [6.780955789088654, 53.537099530642983],
            [6.928187996435048, 52.175201612688845],
            [6.02639072643839, 51.843929146159461],
            [5.8239464413371, 51.034152005754301],
            [6.339259167049475, 50.371607072695532],
            [6.357663192967775, 49.543425906372072],
            [8.345297992144079, 48.917689025149905],
            [7.49871279990232, 47.574195133114067],
            [10.332932791320385, 47.35334682209448],
            [13.019920575392057, 47.48217500352257],
            [12.762264212535868, 48.126315910663038],
            [13.77448563804232, 48.531204480865625],
            [13.77448563804232, 48.807264869640107],
            [12.596627979271176, 49.451405776780575],
            [12.081315253558801, 50.279586943104036],
            [14.915535244976866, 50.868515772489609],
            [14.989151348650063, 51.347020446365391],
            [14.584262778447481, 52.616898234728026],
            [14.142566156408304, 52.782534467992718],
            [14.473838622937688, 53.2242310900319],
            [14.068950052735106, 54.181240437783451],
            [13.406405119676338, 54.678149137577527],
            [12.578223953352877, 54.383684722884745],
            [11.860466942539212, 54.16283641186515],
            [11.363558242745135, 53.978796152682165],
            [10.811437465196162, 54.015604204518759],
            [11.345154216826836, 54.45730082655794],
            [11.08749785397065, 54.56772498206773],
            [10.793033439277863, 54.310068619211549],
            [10.038468376627598, 54.530916930231136],
            [9.817620065608009, 54.935805500433716],
        ]
    ],
}


def main():
    # Create a map
    map = mapsy.Map()
    tile_layer = mapsy.TiledRasterLayer(
        [
            "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
        ]
    )

    polygon = shape(json)
    fill = mapsy.FillLayer(
        [
            mapsy.FillItem(
                geometry=polygon,
                color=mapsy.Color(0.5, 0.5, 0.5, 0.3),
                line_color=mapsy.Color(0, 0, 0),
                line_width=2,
            )
        ]
    )

    map.add_layer(mapsy.BackgroundLayer(mapsy.Color(1, 1, 1)))
    map.add_layer(tile_layer)
    map.add_layer(fill)

    surf = map.render(
        mapsy.FixedScreenSize(
            Box(*polygon.buffer(0.5).bounds), mapsy.ScreenSize(512, 512)
        )
    )
    surf.write_to_png("simple_map.png")


if __name__ == "__main__":
    main()
